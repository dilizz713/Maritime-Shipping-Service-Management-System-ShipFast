<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
<h2>Upload Quotation Excel</h2>
<input type="file" id="quotationFile" accept=".xlsx,.xls" />
<button id="uploadQuotationBtn">Upload & Save</button>

<div id="excelPreview" style="margin-top: 20px;"></div>

<script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>

<script>
    let uploadedFileData = null;

    $("#quotationFile").on("change", function(e) {
        const file = e.target.files[0];
        if(!file) return;

        const reader = new FileReader();
        reader.onload = function(event) {
            const data = new Uint8Array(event.target.result);
            const workbook = XLSX.read(data, { type: 'array' });

            const firstSheetName = workbook.SheetNames[0];
            const worksheet = workbook.Sheets[firstSheetName];


            const html = XLSX.utils.sheet_to_html(worksheet, { id: "sheetTable", editable: false });
            $("#excelPreview").html(html);

            uploadedFileData = data;
        };
        reader.readAsArrayBuffer(file);
    });


    $("#uploadQuotationBtn").click(function() {
        if(!uploadedFileData) return alert("Select a file first!");

        const jobId = $("#jobId").val();
        const file = $("#quotationFile")[0].files[0];

        const formData = new FormData();
        formData.append("file", file);

        $.ajax({
            url: `http://localhost:8080/api/v1/job-quotation/upload/${jobId}`,
            method: "POST",
            data: formData,
            processData: false,
            contentType: false,
            success: function(res) {
                alert(res.message);
                // Optionally, reload quotations table or UI
            },
            error: function(err) {
                console.error(err);
                alert("Error uploading quotation!");
            }
        });
    });


</script>
</body>
</html>